<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø®Ø¯Ù…Ø§Øª - OBS</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .services-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .services-container .inner-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .status-box {
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
            font-weight: bold;
        }
        
        .status-box.connected {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }
        
        .status-box.error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
        
        .services-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 768px) {
            .services-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .service-form, .services-list {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #dee2e6;
        }
        
        .service-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .service-meta {
            color: #6c757d;
            font-size: 14px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <nav>
        <div class="logo">OBS ğŸ“¢</div>
        <div class="nav-links">
            <a href="index.html">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="services.html" class="active">ğŸ› ï¸ Ø§Ù„Ø®Ø¯Ù…Ø§Øª</a>
            <a href="ads.html">ğŸ“¢ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</a>
            <a href="user.html">ğŸ‘¤ Ø­Ø³Ø§Ø¨ÙŠ</a>
        </div>
    </nav>

    <div class="container">
        <h1>ğŸ› ï¸ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</h1>
        
        <div class="services-container">
            <div class="inner-container">
                <div class="header">
                    <h2 style="color: #667eea; text-align: center;">OBS Ø®Ø¯Ù…Ø§Øª Firebase</h2>
                    <p style="text-align: center;">Ù†Ø¸Ø§Ù… Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</p>
                </div>
                
                <div id="firebaseStatus" class="status-box">
                    ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
                </div>
                
                <div class="services-grid">
                    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø®Ø¯Ù…Ø© -->
                    <div class="service-form">
                        <h3>â• Ø£Ø¶Ù Ø®Ø¯Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                        <div class="form-group">
                            <label>ğŸ‘¤ Ø§Ø³Ù…Ùƒ</label>
                            <input type="text" id="name" placeholder="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯">
                        </div>
                        <div class="form-group">
                            <label>ğŸ· Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</label>
                            <select id="service">
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø©</option>
                                <option value="Ø³Ù…ÙƒØ±ÙŠ">ğŸ”¨ Ø³Ù…ÙƒØ±ÙŠ</option>
                                <option value="Ù†Ø¬Ø§Ø±">ğŸªš Ù†Ø¬Ø§Ø±</option>
                                <option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ">âš¡ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ</option>
                                <option value="Ø³Ø¨Ø§Ùƒ">ğŸš° Ø³Ø¨Ø§Ùƒ</option>
                                <option value="Ù…Ø¯Ø±Ø³">ğŸ“š Ù…Ø¯Ø±Ø³ Ø®ØµÙˆØµÙŠ</option>
                                <option value="Ø¨Ø±Ù…Ø¬Ø©">ğŸ’» Ø¨Ø±Ù…Ø¬Ø© ÙˆØªØ·ÙˆÙŠØ±</option>
                                <option value="ØªØµÙ…ÙŠÙ…">ğŸ¨ ØªØµÙ…ÙŠÙ… Ø¬Ø±Ø§ÙÙŠÙƒ</option>
                                <option value="Ù†Ù‚Ù„">ğŸšš Ù†Ù‚Ù„ ÙˆØ´Ø­Ù†</option>
                                <option value="ØªÙ†Ø¸ÙŠÙ">ğŸ§¹ ØªÙ†Ø¸ÙŠÙ Ù…Ù†Ø§Ø²Ù„</option>
                                <option value="ØµÙŠØ§Ù†Ø©">ğŸ”§ ØµÙŠØ§Ù†Ø© Ø£Ø¬Ù‡Ø²Ø©</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ğŸ“Œ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø®Ø¯Ù…Ø©</label>
                            <input type="text" id="title" placeholder="Ù…Ø«Ø§Ù„: Ø³Ù…ÙƒØ±ÙŠ Ù…Ù†Ø²Ù„ÙŠ Ù…Ø­ØªØ±Ù">
                        </div>
                        <div class="form-group">
                            <label>ğŸ“ ÙˆØµÙ Ø§Ù„Ø®Ø¯Ù…Ø©</label>
                            <textarea id="description" placeholder="ÙˆØµÙ Ù…ÙØµÙ„ Ù„Ù„Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙŠ ØªÙ‚Ø¯Ù…Ù‡Ø§..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>ğŸ“ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</label>
                            <input type="text" id="location" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©/Ø§Ù„Ø­ÙŠ">
                        </div>
                        <div class="form-group">
                            <label>ğŸ“ ÙˆØ³Ø§Ø¦Ù„ Ø§Ù„ØªÙˆØ§ØµÙ„</label>
                            <input type="text" id="contact" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø£Ùˆ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨">
                        </div>
                        <div class="form-group">
                            <label>ğŸ’° Ø§Ù„Ø³Ø¹Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <input type="text" id="price" placeholder="Ù…Ø«Ø§Ù„: 50 Ø±ÙŠØ§Ù„">
                        </div>
                        <button class="btn-primary" onclick="addService()">
                            ğŸš€ Ù†Ø´Ø± Ø§Ù„Ø®Ø¯Ù…Ø©
                        </button>
                    </div>
                    
                    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª -->
                    <div class="services-list">
                        <h3>ğŸ“‹ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</h3>
                        <div id="servicesContainer">
                            <div class="loading">
                                <div class="spinner"></div>
                                <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø§Øª...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© -->
        <div class="card">
            <h3>ğŸ” Ø¨Ø­Ø« ÙˆØªØµÙÙŠØ© Ø§Ù„Ø®Ø¯Ù…Ø§Øª</h3>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø®Ø¯Ù…Ø©..." style="flex: 1;">
                <select id="serviceFilter" style="width: 200px;">
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø¯Ù…Ø§Øª</option>
                    <option value="Ø³Ù…ÙƒØ±ÙŠ">Ø³Ù…ÙƒØ±ÙŠ</option>
                    <option value="Ù†Ø¬Ø§Ø±">Ù†Ø¬Ø§Ø±</option>
                    <option value="ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ">ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ</option>
                    <option value="Ø³Ø¨Ø§Ùƒ">Ø³Ø¨Ø§Ùƒ</option>
                </select>
                <select id="locationFilter" style="width: 200px;">
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</option>
                    <option value="Ø§Ù„Ø±ÙŠØ§Ø¶">Ø§Ù„Ø±ÙŠØ§Ø¶</option>
                    <option value="Ø¬Ø¯Ø©">Ø¬Ø¯Ø©</option>
                    <option value="Ø§Ù„Ø¯Ù…Ø§Ù…">Ø§Ù„Ø¯Ù…Ø§Ù…</option>
                </select>
                <button class="btn-secondary" onclick="filterServices()">Ø¨Ø­Ø«</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { database } from './firebase-config.js';
        import { ref, set, onValue, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

        let allServices = [];
        let currentUser = null;

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„
        window.onload = function() {
            checkFirebaseConnection();
            loadServices();
        };

        function checkFirebaseConnection() {
            const statusDiv = document.getElementById('firebaseStatus');
            try {
                const testRef = ref(database, 'connection_test');
                set(testRef, { timestamp: Date.now() })
                    .then(() => {
                        statusDiv.textContent = "âœ… Ù…ØªØµÙ„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­";
                        statusDiv.className = "status-box connected";
                    })
                    .catch(error => {
                        console.error("Firebase Error:", error);
                        statusDiv.textContent = "âš ï¸ ØªØ³ØªØ®Ø¯Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ Ø­Ø§Ù„ÙŠØ§Ù‹";
                        statusDiv.className = "status-box error";
                    });
            } catch (error) {
                statusDiv.textContent = "âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„";
                statusDiv.className = "status-box error";
            }
        }

        function addService() {
            const service = {
                name: document.getElementById('name').value.trim(),
                service: document.getElementById('service').value,
                title: document.getElementById('title').value.trim(),
                description: document.getElementById('description').value.trim(),
                location: document.getElementById('location').value.trim(),
                contact: document.getElementById('contact').value.trim(),
                price: document.getElementById('price').value.trim(),
                date: new Date().toISOString(),
                id: Date.now().toString(),
                userId: currentUser?.uid || 'anonymous',
                userEmail: currentUser?.email || 'Ø²Ø§Ø¦Ø±'
            };
            
            if (!service.name || !service.service || !service.title || !service.contact) {
                alert("âš ï¸ Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ø®Ø¯Ù…Ø©ØŒ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†ØŒ Ø§Ù„ØªÙˆØ§ØµÙ„)!");
                return;
            }
            
            const serviceRef = ref(database, 'services/' + service.id);
            set(serviceRef, service)
                .then(() => {
                    alert("âœ… ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø®Ø¯Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!");
                    clearForm();
                })
                .catch(error => {
                    alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø´Ø±: " + error.message);
                });
        }

        function clearForm() {
            document.getElementById('name').value = '';
            document.getElementById('service').value = '';
            document.getElementById('title').value = '';
            document.getElementById('description').value = '';
            document.getElementById('location').value = '';
            document.getElementById('contact').value = '';
            document.getElementById('price').value = '';
        }

        function loadServices() {
            const container = document.getElementById('servicesContainer');
            const servicesRef = ref(database, 'services');
            
            onValue(servicesRef, (snapshot) => {
                allServices = [];
                container.innerHTML = '';
                
                snapshot.forEach((child) => {
                    allServices.push(child.val());
                });
                
                if (allServices.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: #6c757d;">
                            <p>ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®Ø¯Ù…Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                            <p>ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ¶ÙŠÙ Ø®Ø¯Ù…Ø©!</p>
                        </div>
                    `;
                    return;
                }
                
                // ØªØ±ØªÙŠØ¨ Ù…Ù† Ø§Ù„Ø£Ø­Ø¯Ø«
                allServices.sort((a, b) => new Date(b.date) - new Date(a.date));
                displayServices(allServices);
            }, {
                onlyOnce: false // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ
            });
        }

        function displayServices(services) {
            const container = document.getElementById('servicesContainer');
            
            container.innerHTML = services.map(service => `
                <div class="service-card">
                    <h4>${service.title}</h4>
                    <div class="service-meta">
                        <strong>ğŸ‘¤ ${service.name}</strong> | 
                        <strong>ğŸ· ${service.service}</strong> | 
                        <strong>ğŸ“ ${service.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</strong>
                    </div>
                    <p>${service.description}</p>
                    <div class="service-meta">
                        <strong>ğŸ“ ${service.contact}</strong> | 
                        ${service.price ? `<strong>ğŸ’° ${service.price}</strong> | ` : ''}
                        ğŸ•’ ${new Date(service.date).toLocaleString('ar-EG')}
                    </div>
                    ${service.userId === currentUser?.uid ? `
                        <div style="margin-top: 10px;">
                            <button onclick="deleteService('${service.id}')" class="btn-danger" style="padding: 5px 10px; font-size: 12px;">
                                Ø­Ø°Ù
                            </button>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function filterServices() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const serviceFilter = document.getElementById('serviceFilter').value;
            const locationFilter = document.getElementById('locationFilter').value;
            
            const filtered = allServices.filter(service => {
                const matchesSearch = !searchTerm || 
                    service.title.toLowerCase().includes(searchTerm) ||
                    service.description.toLowerCase().includes(searchTerm) ||
                    service.name.toLowerCase().includes(searchTerm);
                
                const matchesService = !serviceFilter || service.service === serviceFilter;
                const matchesLocation = !locationFilter || service.location === locationFilter;
                
                return matchesSearch && matchesService && matchesLocation;
            });
            
            displayServices(filtered);
        }

        window.deleteService = function(serviceId) {
            if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø¯Ù…Ø©ØŸ")) {
                const serviceRef = ref(database, 'services/' + serviceId);
                remove(serviceRef)
                    .then(() => {
                        alert("âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø®Ø¯Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­");
                    })
                    .catch(error => {
                        alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù: " + error.message);
                    });
            }
        };

        // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©
        setInterval(loadServices, 60000);
    </script>
</body>
</html>